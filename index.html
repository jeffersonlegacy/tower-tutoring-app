<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tower Tutoring Workspace</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“š</text></svg>">
    
    <link href="/style.css" rel="stylesheet">
    
    <link href="https://unpkg.com/tldraw@2.1.4/dist/tldraw.css" rel="stylesheet">
    <script src="https://unpkg.com/tldraw@2.1.4/dist/tldraw.umd.js" defer></script>
    
    <script src="https://meet.jit.si/external_api.js" defer></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-slate-900 text-white font-sans">

    <div id="loginView" class="min-h-screen flex flex-col items-center justify-center p-4 bg-gradient-to-br from-slate-900 to-slate-700">
        <div class="w-full max-w-sm text-center">
            <div class="mx-auto w-32 h-32 rounded-full bg-slate-800 flex items-center justify-center border-4 border-slate-700 mb-4 shadow-lg">
                <svg class="w-16 h-16 text-sky-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 11c0 3.517-1.009 6.79-2.73 9.563M12 11V3m0 8h.01M12 11a9 9 0 100 18 9 9 0 000-18z"></path></svg>
            </div>
            <h1 class="text-4xl font-bold">Tower Tutoring</h1>
            <p class="text-sky-300 mt-2 mb-6">Interactive Learning Workspaces</p>
            <div class="bg-slate-800/50 backdrop-blur-sm p-8 rounded-2xl shadow-2xl border border-white/20">
                <input id="nicknameInput" class="w-full px-4 py-3 bg-slate-700 text-white border-2 border-slate-600 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-sky-500" type="text" placeholder="Enter Session Name" required>
                <button id="joinBtn" class="w-full bg-sky-600 hover:bg-sky-700 font-bold py-3 px-4 rounded-lg">
                    Join Workspace
                </button>
            </div>
        </div>
    </div>
    
    <div id="appView" style="display: none;" class="flex flex-col h-screen p-4">
        <h1 id="sessionNameDisplay" class="text-xl font-bold mb-4"></h1>
        <div id="whiteboardContainer" style="width: 100%; height: 500px; border: 1px solid #4A5568;"></div>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-check-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBQAjV9LYgB_HUPLONqdhFEHg0K9mmR_TQ",
            authDomain: "towertutoring-e48ac.firebaseapp.com",
            projectId: "towertutoring-e48ac",
            storageBucket: "towertutoring-e48ac.appspot.com",
            messagingSenderId: "962909548649",
            appId: "1:962909548649:web:8be51e20d7f6c852c172f8"
        };
        const recaptchaV3SiteKey = "6LdCQMwrAAAAAPbrXbfTEAUfqdp03V0xpNB4KjaB";

        firebase.initializeApp(firebaseConfig);
        const appCheck = firebase.appCheck();
        const auth = firebase.auth();
        
        self.FIREBASE_APPCHECK_DEBUG_TOKEN = true;
        
        appCheck.activate(
            new firebase.appCheck.ReCaptchaV3Provider(recaptchaV3SiteKey),
            true
        );
        
        const loginView = document.getElementById('loginView');
        const appView = document.getElementById('appView');
        const joinBtn = document.getElementById('joinBtn');
        const nicknameInput = document.getElementById('nicknameInput');
        const sessionNameDisplay = document.getElementById('sessionNameDisplay');
        const whiteboardContainer = document.getElementById('whiteboardContainer');
        let tldrawEditor = null;

        joinBtn.addEventListener('click', async () => {
            const nickname = nicknameInput.value.trim();
            if (!nickname) {
                alert('Please enter a session name.');
                return;
            }
            
            console.log('Attempting to sign in...');
            try {
                await auth.signInAnonymously();
                console.log('Sign-in successful!');
                
                loginView.style.display = 'none';
                appView.style.display = 'flex';
                sessionNameDisplay.textContent = `Session: ${nickname}`;

                const { Tldraw } = tldraw;
                if (whiteboardContainer && !tldrawEditor) {
                    tldrawEditor = new Tldraw({ parent: whiteboardContainer });
                }

            } catch (error) {
                console.error("Sign-in failed:", error);
                alert('Sign-in failed. Check the console for details.');
            }
        });
    </script>
</body>
</html>
</html>